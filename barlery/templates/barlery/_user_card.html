{% comment %}
User Card Partial

Expected context:
  - user: User object
  - variant: "active" | "pending" | "deactivated"
{% endcomment %}

<div
  class="{% if variant == 'pending' %}pending-user-card{% else %}user-card{% endif %} account-card"
  data-user-id="{{ user.id }}"
>

  <!-- Header -->
  <div class="{% if variant == 'pending' %}pending-user-header{% else %}user-card-header{% endif %}">
    <h3 class="user-name">{{ user.first_name }} {{ user.last_name }}</h3>

    {% if variant == "pending" %}
      <span class="status-badge status-pending">
        <i class="fas fa-clock"></i> Pending
      </span>
    {% elif variant == "deactivated" %}
      <span class="status-badge status-deactivated">
        <i class="fas fa-times-circle"></i> Deactivated
      </span>
    {% else %}
      <span class="status-badge status-active">
        <i class="fas fa-check-circle"></i> Active
      </span>
    {% endif %}
  </div>

  <!-- Body -->
  <div class="{% if variant == 'pending' %}pending-user-body{% else %}user-card-body{% endif %}">
    <div class="user-detail">
      <span class="detail-label"><i class="fas fa-envelope"></i> Email:</span>
      <span class="detail-value">{{ user.email }}</span>
    </div>

    {% if user.phone %}
    <div class="user-detail">
      <span class="detail-label"><i class="fas fa-phone"></i> Phone:</span>
      <span class="detail-value">{{ user.phone }}</span>
    </div>
    {% endif %}

    <div class="user-detail">
      <span class="detail-label"><i class="fas fa-key"></i> Permissions:</span>
      <span class="detail-value">
        {% if variant == "pending" %}
          <select class="permission-select" data-user-id="{{ user.id }}">
            <option value="basic">Basic</option>
            <option value="elevated">Elevated</option>
          </select>
        {% elif variant == "deactivated" %}
          None
        {% elif user.is_staff %}
          Elevated
        {% else %}
          Basic
        {% endif %}
      </span>
    </div>

    {% if variant == "pending" %}
      <div class="user-detail">
        <span class="detail-label"><i class="fas fa-calendar-plus"></i> Requested:</span>
        <span class="detail-value">{{ user.date_joined|date:"M d, Y g:i A" }}</span>
      </div>
    {% else %}
      <div class="user-detail">
        <span class="detail-label"><i class="fas fa-calendar-plus"></i> Date Joined:</span>
        <span class="detail-value">{{ user.date_joined|date:"M d, Y" }}</span>
      </div>

      <div class="user-detail">
        <span class="detail-label"><i class="fas fa-clock"></i> Last Login:</span>
        <span class="detail-value">
          {% if user.last_login %}
            {{ user.last_login|date:"M d, Y g:i A" }}
          {% else %}
            Never
          {% endif %}
        </span>
      </div>
    {% endif %}
  </div>

  <!-- Actions -->
  <div class="{% if variant == 'pending' %}pending-user-actions{% else %}user-card-actions{% endif %}">
    {% if variant == "active" %}
      <a href="{% url 'barlery:edit_user' user.id %}" class="btn btn-secondary btn-sm">
        <i class="fas fa-edit"></i> Edit
      </a>
      
      <button
        class="btn btn-danger btn-sm"
        data-action="deactivate"
        data-url="{% url 'barlery:deactivate_user' user.id %}"
        data-user-first-name="{{ user.first_name }}"
        data-user-last-name="{{ user.last_name }}"
      >
        <i class="fas fa-user-slash"></i> Deactivate Account
      </button>

    {% elif variant == "deactivated" %}
      <button
        class="btn btn-primary btn-sm"
        data-action="activate"
        data-url="{% url 'barlery:activate_user' user.id %}"
        data-user-first-name="{{ user.first_name }}"
        data-user-last-name="{{ user.last_name }}"
      >
        <i class="fas fa-user-check"></i> Reactivate Account
      </button>

    {% else %}
      <button
        class="btn btn-primary btn-sm"
        data-action="activate"
        data-url="{% url 'barlery:activate_user' user.id %}"
        data-user-first-name="{{ user.first_name }}"
        data-user-last-name="{{ user.last_name }}"
        data-user-email="{{ user.email }}"
      >
        <i class="fas fa-user-check"></i> Activate Account
      </button>
    {% endif %}
  </div>

</div>